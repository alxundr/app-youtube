/*! app-youtube 2015-01-20 */
function initLogin(){$("#btn").click(signIn)}function signIn(){console.log("entro a signIn");var a=$("#username").val(),b=$("#password").val(),c="http://127.0.0.1:4000/login";jQuery.ajax({type:"POST",url:c,dataType:"json",data:{username:a,password:b},success:onGetSuccess,error:onGetFail})}function onGetSuccess(a,b,c){console.log(b),console.log(c);var d=$("#result");d.html("<p>apiKey: "+a.apiKey+"</p>"),console.log(c.responseText),"success"===a.status?($("#username").val(""),$("#password").val(""),window.location.replace("http://127.0.0.1:9000/?apiKey="+a.apiKey)):alert("wrong username or password")}function onGetFail(a){alert("Error: "+a.responseText)}function initComponents(){$("#next-page").hide(),$("#prev-page").hide(),$(".dropdown").hide(),$("#search-btn").addClass("disabled"),totalResults=0,$("#search-input").val(""),$("#response-title").html(""),$("#response-total").html(""),$("#response-page").html(""),$("#response").html("")}function getUrlParameter(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}}function onClientLoad(){initComponents();var a=$("#search-input").val().length;a>0&&$("#search-btn").removeClass("disabled"),$("#signout-btn").click(signOut),apiKey=getUrlParameter("apiKey"),apiKey?gapi.client.load("youtube","v3",onYouTubeApiLoad):window.location.replace("http://127.0.0.1:9000/login.html")}function signOut(){apiKey="",window.location.replace("http://127.0.0.1:9000/login.html")}function onYouTubeApiLoad(){gapi.client.setApiKey(apiKey),$("#search-input").keyup(checkInputChange),$("#search-input").select(checkInputChange),$("#search-btn").click(submitQuery),$("#next-page").click(nextPage),$("#prev-page").click(prevPage),$(document.body).on("click",".result .item",function(){var a=$(this).parent().attr("class");"result current mouseover"===a||"result mouseover current"===a||"result current"===a?($(this).parent().removeClass("current"),$(this).parent().children(".description").hide()):($(".result").removeClass("current"),$(".description").hide(),$(this).parent().addClass("current"),$(this).parent().children(".description").show())}),$(document.body).on("mouseover",".result .item",function(){$(this).parent().addClass("mouseover"),$(this).parent().mouseout(function(){$(this).removeClass("mouseover")})}),$(document.body).keypress(function(a){if(totalResults>0&&$(this)!=$("#search-input"))if(38===a.keyCode){var b=$(".current"),c=b.prev();0!=c.length&&(b.removeClass("current"),b.children(".description").hide(),c.addClass("current"),c.children(".description").show())}else if(40===a.keyCode){var b=$(".current"),c=b.next();0!=c.length&&(b.removeClass("current"),b.children(".description").hide(),c.addClass("current"),c.children(".description").show())}$(this)!=$("#search-input")&&37===a.keyCode&&totalResults>0&&prevPage(),$(this)!=$("#search-input")&&39===a.keyCode&&totalResults>0&&nextPage()})}function checkInputChange(a){$("#search-input").val().length>0?($("#search-btn").removeClass("disabled"),13===a.keyCode&&submitQuery()):$("#search-btn").addClass("disabled")}function submitQuery(){query=$("#search-input").val(),$("#search-input").val(""),$("#search-btn").addClass("disabled"),totalResults=0,$("#next-page").hide(),$("#prev-page").hide(),query.length>0&&search(query)}function search(a){requestOptions={part:"snippet",q:a,type:"video",maxResults:RESULTS_PER_PAGE};var b=gapi.client.youtube.search.list(requestOptions),c="<h1>Showing results for '<span style='font-style: italic'>"+a+"'</span></h1>";$("#response-title").html(c),currentPage=1,b.execute(onSearchResponse)}function nextPage(){var a=totalResults/RESULTS_PER_PAGE;if(a>0&&a>currentPage){$("#prev-page").show(),requestOptions.pageToken=nextPageToken;var b=gapi.client.youtube.search.list(requestOptions);currentPage++,currentPage>=a&&$("#next-page").hide(),b.execute(onSearchResponse)}}function prevPage(){var a=totalResults/RESULTS_PER_PAGE;if(a>0&&currentPage>1){$("#next-page").show(),requestOptions.pageToken=prevPageToken;var b=gapi.client.youtube.search.list(requestOptions);currentPage--,1===currentPage&&$("#prev-page").hide(),b.execute(onSearchResponse)}}function onSearchResponse(a){a.result.nextPageToken&&(nextPageToken=a.result.nextPageToken),a.result.prevPageToken&&(prevPageToken=a.result.prevPageToken),showResponse(a)}function showResponse(a){var b=a.result.items;if(0===totalResults&&(totalResults=a.result.pageInfo.totalResults,totalResults>0&&$("#next-page").show()),$("#response-total").html("<h3>about "+totalResults+" results <div class='movie'></div></h3>"),$("#response-page").html("<h4>page "+currentPage+"</h4>"),$("#response").html(""),totalResults>0)for(var c=0;c<b.length;c++){var d=b[c];displayResult(d)}else if(0===totalResults){var e="<div class='alert alert-danger' role='alert'><span class='glyphicon glyphicon-exclamation-sign' aria-hidden='true'></span><span class='sr-only'>Error:</span> No results</div>";$("#response").html(e)}}function displayResult(a){var b,c=new Date(a.snippet.publishedAt),d={year:"numeric",month:"short",day:"numeric"},e=a.snippet.description;""===e&&(e="no description"),b=getViews(a.id.videoI);var f="<div class='result'><div class='item row'><div class='col-xs-3'><img src='"+a.snippet.thumbnails["default"].url+"' height='90' width='160'></div><div class='col-xs-9'><p class='title'>"+a.snippet.title+"</p><p class='channel'>by <a href='https://www.youtube.com/user/"+a.snippet.channelTitle+"' target='_blank'>"+a.snippet.channelTitle+"</a></p><p class='channel'>"+c.toLocaleDateString("en-US",d)+" &middot; "+b+" views</p><p>"+e+"</p></div></div><div class='description row'><div class='col-xs-12'><div class='embed-responsive embed-responsive-16by9'><iframe class='embed-responsive-item' src='http://www.youtube.com/embed/"+a.id.videoId+"'></iframe></div></div></div></div>";$("#response").append(f)}function getViews(a){var b,c="http://10.50.24.138:8080/RestApp/rest?message="+a;return jQuery.ajax({type:"GET",url:c,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){b=a.val},error:function(){b="error"}}),b}var requestOptions,nextPageToken,prevPageToken,currentPage,totalResults=0,RESULTS_PER_PAGE=5,apiKey;